FROM patroni:2.1-pg15

# Install required tools
RUN apk add --no-cache curl ca-certificates

# Create patroni config directory  
RUN mkdir -p /etc/patroni && chmod 755 /etc/patroni

# Create health check script  
RUN printf '#!/bin/bash\ncurl -f http://localhost:8008/health 2>/dev/null || exit 1\n' > /usr/local/bin/health-check.sh && \
    chmod +x /usr/local/bin/health-check.sh

EXPOSE 5432 8008

# Default to running patroni daemon
CMD ["patroni", "/etc/patroni/patroni.yml"]
